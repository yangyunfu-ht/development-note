import{_ as i,o as a,c as t,ag as n}from"./chunks/framework.CbQjVMS6.js";const E=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"javascript/components/eventLoop.md","filePath":"javascript/components/eventLoop.md"}'),l={name:"javascript/components/eventLoop.md"};function e(h,s,p,k,o,r){return a(),t("div",null,[...s[0]||(s[0]=[n(`<h2 id="事件循环-event-loop" tabindex="-1">事件循环 (Event Loop) <a class="header-anchor" href="#事件循环-event-loop" aria-label="Permalink to &quot;事件循环 (Event Loop)&quot;">​</a></h2><p>JavaScript 是一门<strong>单线程</strong>的非阻塞脚本语言。为了协调事件、用户交互、脚本、渲染、网络等，JavaScript 必须使用事件循环（Event Loop）机制来处理异步任务。</p><h3 id="_1-核心概念" tabindex="-1">1. 核心概念 <a class="header-anchor" href="#_1-核心概念" aria-label="Permalink to &quot;1. 核心概念&quot;">​</a></h3><ul><li><p><strong>执行栈 (Call Stack)</strong>： JavaScript 引擎维护一个执行栈，用于追踪函数调用。这是一个同步过程，遵循<strong>后进先出 (LIFO)</strong> 原则。所有同步代码都在这里执行。</p></li><li><p><strong>任务队列 (Task Queue)</strong>： 当遇到异步操作（如 <code>setTimeout</code>, <code>fetch</code>）时，回调函数会在异步操作完成后被放入任务队列中等待执行。</p></li></ul><h3 id="_2-宏任务与微任务" tabindex="-1">2. 宏任务与微任务 <a class="header-anchor" href="#_2-宏任务与微任务" aria-label="Permalink to &quot;2. 宏任务与微任务&quot;">​</a></h3><p>在事件循环中，异步任务被分为两类，它们的执行优先级不同。</p><table tabindex="0"><thead><tr><th style="text-align:left;">任务类型</th><th style="text-align:left;">描述</th><th style="text-align:left;">常见 API</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>宏任务 (MacroTask)</strong></td><td style="text-align:left;">由宿主环境（浏览器/Node）发起的任务</td><td style="text-align:left;"><code>script</code>(整体代码), <code>setTimeout</code>, <code>setInterval</code>, <code>setImmediate</code>(Node), <code>requestAnimationFrame</code>, I/O</td></tr><tr><td style="text-align:left;"><strong>微任务 (MicroTask)</strong></td><td style="text-align:left;">由 JavaScript 引擎发起的任务</td><td style="text-align:left;"><code>Promise.then/catch/finally</code>, <code>process.nextTick</code>(Node), <code>MutationObserver</code></td></tr></tbody></table><h3 id="_3-循环流程-the-loop" tabindex="-1">3. 循环流程 (The Loop) <a class="header-anchor" href="#_3-循环流程-the-loop" aria-label="Permalink to &quot;3. 循环流程 (The Loop)&quot;">​</a></h3><p>事件循环的每一次迭代称为一个 <strong>Tick</strong>，其基本流程如下：</p><ol><li><strong>执行栈</strong>：执行当前执行栈中的所有同步代码。</li><li><strong>微任务队列</strong>：当执行栈为空时，<strong>清空</strong>当前的微任务队列。 <ul><li>如果在执行微任务期间产生了新的微任务，会继续添加到队列末尾并在当前周期执行。</li></ul></li><li><strong>UI 渲染</strong>：(浏览器环境) 如果需要，浏览器进行 UI 更新。</li><li><strong>宏任务队列</strong>：从宏任务队列中取出<strong>一个</strong>任务执行。</li><li><strong>重复</strong>：回到步骤 1。</li></ol><blockquote><p><strong>核心口诀</strong>：同步优先 -&gt; 微任务清空 -&gt; 渲染 -&gt; 宏任务一个 -&gt; 循环</p></blockquote><h3 id="_4-代码实战解析" tabindex="-1">4. 代码实战解析 <a class="header-anchor" href="#_4-代码实战解析" aria-label="Permalink to &quot;4. 代码实战解析&quot;">​</a></h3><h4 id="示例-1-基础顺序" tabindex="-1">示例 1：基础顺序 <a class="header-anchor" href="#示例-1-基础顺序" aria-label="Permalink to &quot;示例 1：基础顺序&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 同步</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 宏任务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 微任务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 同步</span></span></code></pre></div><p><strong>输出结果</strong>：<code>1</code> -&gt; <code>4</code> -&gt; <code>3</code> -&gt; <code>2</code></p><p><strong>解析</strong>：</p><ol><li>同步代码 <code>1</code>, <code>4</code> 先执行。</li><li>同步执行完，检查微任务，执行 <code>3</code>。</li><li>微任务清空，执行宏任务 <code>2</code>。</li></ol><hr><h4 id="示例-2-综合面试题" tabindex="-1">示例 2：综合面试题 <a class="header-anchor" href="#示例-2-综合面试题" aria-label="Permalink to &quot;示例 2：综合面试题&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Promise 构造函数是同步的</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;5&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;6&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p><strong>输出结果</strong>：<code>1</code> -&gt; <code>4</code> -&gt; <code>6</code> -&gt; <code>5</code> -&gt; <code>2</code> -&gt; <code>3</code></p><p><strong>深度解析</strong>：</p><ol><li><p><strong>第一轮 (同步 + 微任务)</strong></p><ul><li>打印 <code>1</code>。</li><li><code>setTimeout</code> 注册宏任务 <strong>[Macro1]</strong>。</li><li><code>new Promise</code> 同步执行打印 <code>4</code>。</li><li><code>.then</code> 注册微任务 <strong>[Micro1]</strong> (打印 5)。</li><li>打印 <code>6</code>。</li><li><strong>清空微任务</strong>：执行 <strong>[Micro1]</strong> -&gt; 打印 <code>5</code>。</li></ul></li><li><p><strong>第二轮 (宏任务)</strong></p><ul><li>取出 <strong>[Macro1]</strong> 执行 -&gt; 打印 <code>2</code>。</li><li>遇到 <code>Promise.then</code>，注册微任务 <strong>[Micro2]</strong> (打印 3)。</li><li><strong>宏任务执行完，再次清空微任务</strong>。</li><li>执行 <strong>[Micro2]</strong> -&gt; 打印 <code>3</code>。</li></ul></li></ol>`,23)])])}const g=i(l,[["render",e]]);export{E as __pageData,g as default};
