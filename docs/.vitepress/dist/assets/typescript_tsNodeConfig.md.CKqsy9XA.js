import{_ as t,o as i,c as a,ag as e}from"./chunks/framework.CbQjVMS6.js";const c=JSON.parse('{"title":"tsconfig.node.json 配置详解","description":"","frontmatter":{},"headers":[],"relativePath":"typescript/tsNodeConfig.md","filePath":"typescript/tsNodeConfig.md"}'),n={name:"typescript/tsNodeConfig.md"};function l(o,s,h,d,p,k){return i(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="tsconfig-node-json-配置详解" tabindex="-1">tsconfig.node.json 配置详解 <a class="header-anchor" href="#tsconfig-node-json-配置详解" aria-label="Permalink to &quot;tsconfig.node.json 配置详解&quot;">​</a></h1><p>在 Vite 等现代前端项目中，<code>tsconfig.node.json</code> 专门用于配置<strong>运行在 Node.js 环境下的代码</strong>的编译选项。</p><h2 id="为什么需要-tsconfig-node-json" tabindex="-1">为什么需要 tsconfig.node.json？ <a class="header-anchor" href="#为什么需要-tsconfig-node-json" aria-label="Permalink to &quot;为什么需要 tsconfig.node.json？&quot;">​</a></h2><p>项目中的某些文件（如 <code>vite.config.ts</code>, <code>vitest.config.ts</code> 以及自定义脚本）是运行在 Node.js 环境中的，而不是浏览器环境。</p><ul><li><strong>运行环境差异</strong>： <ul><li>Node 环境代码需要 Node 的类型定义 (<code>@types/node</code>)。</li><li>Node 环境代码通常使用 CommonJS 或 ES Modules (Node 规范)，不需要 DOM API。</li></ul></li><li><strong>避免类型冲突</strong>：如果将 DOM 类型库和 Node 类型库混合在同一个配置文件中，可能会导致全局变量冲突（例如 <code>setTimeout</code> 返回值类型不同）。</li></ul><p>因此，将 Node 环境的配置单独抽离到 <code>tsconfig.node.json</code> 是最佳实践。</p><hr><h2 id="vue-3-vite-配置示例" tabindex="-1">Vue 3 + Vite 配置示例 <a class="header-anchor" href="#vue-3-vite-配置示例" aria-label="Permalink to &quot;Vue 3 + Vite 配置示例&quot;">​</a></h2><p>以下是 Vue 3 + Vite 项目中典型的 <code>tsconfig.node.json</code> 配置：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;extends&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@vue/tsconfig/tsconfig.node.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;include&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;vite.config.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;vitest.config.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;cypress.config.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;nightwatch.conf.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;playwright.config.*&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;composite&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ESNext&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;moduleResolution&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Bundler&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="关键字段解析" tabindex="-1">关键字段解析 <a class="header-anchor" href="#关键字段解析" aria-label="Permalink to &quot;关键字段解析&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">值</th><th style="text-align:left;">含义与作用</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>extends</strong></td><td style="text-align:left;"><code>@vue/tsconfig/...</code></td><td style="text-align:left;">继承 Vue 官方推荐的 Node 环境基础配置。</td></tr><tr><td style="text-align:left;"><strong>include</strong></td><td style="text-align:left;"><code>[&quot;vite.config.*&quot;, ...]</code></td><td style="text-align:left;">明确指定哪些文件属于 Node 环境（通常是各种配置文件）。</td></tr><tr><td style="text-align:left;"><strong>composite</strong></td><td style="text-align:left;"><code>true</code></td><td style="text-align:left;">启用项目引用，允许被根 <code>tsconfig.json</code> 引用。</td></tr><tr><td style="text-align:left;"><strong>module</strong></td><td style="text-align:left;"><code>ESNext</code></td><td style="text-align:left;">使用现代 ES 模块语法（Vite 默认支持 ESM 配置）。</td></tr><tr><td style="text-align:left;"><strong>moduleResolution</strong></td><td style="text-align:left;"><code>Bundler</code></td><td style="text-align:left;">使用现代打包工具的模块解析策略。</td></tr><tr><td style="text-align:left;"><strong>types</strong></td><td style="text-align:left;"><code>[&quot;node&quot;]</code></td><td style="text-align:left;">显式包含 Node.js 的类型定义，避免污染全局空间（如果没有这个，可能需要手动在文件中 import）。</td></tr></tbody></table><hr><h2 id="react-vite-配置示例" tabindex="-1">React + Vite 配置示例 <a class="header-anchor" href="#react-vite-配置示例" aria-label="Permalink to &quot;React + Vite 配置示例&quot;">​</a></h2><p>以下是 React + Vite 项目中典型的 <code>tsconfig.node.json</code> 配置：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;composite&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;skipLibCheck&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ESNext&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;moduleResolution&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bundler&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;allowSyntheticDefaultImports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;include&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vite.config.ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="关键字段解析-1" tabindex="-1">关键字段解析 <a class="header-anchor" href="#关键字段解析-1" aria-label="Permalink to &quot;关键字段解析&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">字段</th><th style="text-align:left;">值</th><th style="text-align:left;">含义与作用</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>moduleResolution</strong></td><td style="text-align:left;"><code>bundler</code></td><td style="text-align:left;">配合 Vite 使用，确保能正确解析包的 <code>exports</code>。</td></tr><tr><td style="text-align:left;"><strong>allowSyntheticDefaultImports</strong></td><td style="text-align:left;"><code>true</code></td><td style="text-align:left;">允许默认导入没有默认导出的模块（Node 环境常见）。</td></tr><tr><td style="text-align:left;"><strong>include</strong></td><td style="text-align:left;"><code>[&quot;vite.config.ts&quot;]</code></td><td style="text-align:left;">仅包含 Vite 配置文件。</td></tr></tbody></table><hr><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h2><h3 id="_1-为什么-tsconfig-node-json-中没有-lib-dom" tabindex="-1">1. 为什么 <code>tsconfig.node.json</code> 中没有 <code>lib: [&quot;DOM&quot;]</code>？ <a class="header-anchor" href="#_1-为什么-tsconfig-node-json-中没有-lib-dom" aria-label="Permalink to &quot;1. 为什么 \`tsconfig.node.json\` 中没有 \`lib: [&quot;DOM&quot;]\`？&quot;">​</a></h3><ul><li>因为这些代码运行在 Node.js 环境中，不存在 DOM 对象（如 <code>window</code>, <code>document</code>）。如果引入 DOM 库，可能会在编写 Node 脚本时意外使用了浏览器 API，导致运行时错误。</li></ul><h3 id="_2-根目录的-tsconfig-json-是如何引用它的" tabindex="-1">2. 根目录的 <code>tsconfig.json</code> 是如何引用它的？ <a class="header-anchor" href="#_2-根目录的-tsconfig-json-是如何引用它的" aria-label="Permalink to &quot;2. 根目录的 \`tsconfig.json\` 是如何引用它的？&quot;">​</a></h3><ul><li>在根目录的 <code>tsconfig.json</code> 中，通过 <code>references</code> 字段引用：<div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;files&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;references&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./tsconfig.app.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./tsconfig.node.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>这样 TypeScript 就能知道项目被分成了两个独立的部分，分别应用不同的规则。</li></ul><h3 id="_3-如果我有自定义脚本-scripts-build-ts-应该加在哪里" tabindex="-1">3. 如果我有自定义脚本 <code>scripts/build.ts</code>，应该加在哪里？ <a class="header-anchor" href="#_3-如果我有自定义脚本-scripts-build-ts-应该加在哪里" aria-label="Permalink to &quot;3. 如果我有自定义脚本 \`scripts/build.ts\`，应该加在哪里？&quot;">​</a></h3><ul><li>应该加在 <code>tsconfig.node.json</code> 的 <code>include</code> 数组中：<div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;include&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vite.config.*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;scripts/**/*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div>因为这些脚本通常也是在 Node 环境下运行的。</li></ul>`,26)])])}const E=t(n,[["render",l]]);export{c as __pageData,E as default};
