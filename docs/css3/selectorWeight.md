# CSS 选择器权重 (Specificity) 详解

当多个 CSS 规则应用到同一个元素时，浏览器通过**权重 (Specificity)** 算法来决定哪一个规则生效。理解权重计算规则是解决样式冲突的关键。

## 1. 权重等级

CSS 权重通常用一个四元组 `(A, B, C, D)` 来表示，或者简单地看作四个等级。

| 等级       | 选择器类型                                    | 权重值 | 示例                                |
| :--------- | :-------------------------------------------- | :----- | :---------------------------------- |
| **第一等** | **内联样式** (Inline Styles)                  | 1000   | `style="color: red;"`               |
| **第二等** | **ID 选择器**                                 | 100    | `#header`                           |
| **第三等** | **类**、**属性**、**伪类**                    | 10     | `.class`, `[type="text"]`, `:hover` |
| **第四等** | **标签** (元素)、**伪元素**                   | 1      | `div`, `p`, `::before`              |
| **忽略**   | 通配符 `*`、组合符 `+ > ~`、否定伪类 `:not()` | 0      | `*`, `>`, `:not()` (看括号内权重)   |

> **注意**：`:not()` 伪类本身不增加权重，但它括号内的选择器会参与权重计算。

## 2. 计算规则

权重的计算方式是将所有选择器的权重值相加。比较时，**从左到右**依次比较。

1.  先比较 A (内联样式)。
2.  如果 A 相同，比较 B (ID 选择器个数)。
3.  如果 B 相同，比较 C (类/属性/伪类选择器个数)。
4.  如果 C 相同，比较 D (标签/伪元素选择器个数)。

### 示例计算

| 选择器                          | ID (B) | 类/伪类 (C) | 标签 (D) | 权重值  |
| :------------------------------ | :----: | :---------: | :------: | :------ |
| `h1`                            |   0    |      0      |    1     | 0-0-0-1 |
| `#content h1`                   |   1    |      0      |    1     | 0-1-0-1 |
| `.box .title`                   |   0    |      2      |    0     | 0-0-2-0 |
| `div#main ul.nav li`            |   1    |      1      |    3     | 0-1-1-3 |
| `a:hover`                       |   0    |      1      |    1     | 0-0-1-1 |
| `body #content .data img:hover` |   1    |      2      |    2     | 0-1-2-2 |

## 3. 特殊规则

### !important

`!important` **不是**选择器，但它是 CSS 级联规则中的“核武器”。

- 添加了 `!important` 的声明会覆盖任何其他声明（包括内联样式）。
- 只有另一个 `!important` 且具有更高或相同权重的规则才能覆盖它。
- **建议**：尽量避免使用 `!important`，除非在覆盖第三方库样式等无奈的情况下。

### 后来居上 (Source Order)

如果两个选择器的**权重完全相同**，那么**后定义**的规则会覆盖先定义的规则。

```css
.box {
  color: red;
}
.box {
  color: blue;
} /* 权重相同，后者生效，颜色为 blue */
```

### 继承 (Inheritance)

继承来的样式权重为 **0**（甚至低于通配符）。
即使父元素有 `!important`，子元素继承的样式也很容易被子元素自身的样式覆盖。

```css
#parent {
  color: red !important;
}
span {
  color: blue;
} /* span 会显示蓝色，因为继承权重极低 */
```

## 4. 实战练习

假设有以下 HTML：

```html
<div id="app" class="container">
  <p class="text">Hello CSS</p>
</div>
```

以下 CSS 规则谁会生效？

```css
/* 规则 1: 权重 0-0-0-1 */
p {
  color: grey;
}

/* 规则 2: 权重 0-0-1-0 */
.text {
  color: yellow;
}

/* 规则 3: 权重 0-0-1-1 */
div p {
  color: green;
} /* 错误！这里是 0-0-0-2 (两个标签) */
/* 修正: .container p 是 0-0-1-1 */

/* 让我们重新计算一组真实的： */

/* A: 0-0-0-1 */
p {
  color: blue;
}

/* B: 0-0-1-0 */
.text {
  color: red;
}

/* C: 0-1-0-1 */
#app p {
  color: green;
}

/* D: 1-0-0-0 (如果是内联 style="color: purple") */
```

**结果**：如果有内联样式，显示紫色；否则显示绿色 (#app p)；再否则显示红色 (.text)。

## 5. 总结建议

1.  **保持低权重**：尽量使用类选择器 (`.class`)，避免过度使用 ID 选择器，这样更容易覆盖样式。
2.  **减少嵌套**：不要写过深的选择器（如 `div ul li a span`），这会增加权重且降低性能，通常建议不超过 3 层。
3.  **避免 `!important`**：维护噩梦的开始。
